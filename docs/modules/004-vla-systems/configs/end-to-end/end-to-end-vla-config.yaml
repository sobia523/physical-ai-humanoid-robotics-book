# End-to-End VLA System Configuration

end_to_end_vla:
  # System-wide configuration
  system:
    # Core system parameters
    system_name: "autonomous_humanoid"
    system_version: "1.0.0"
    execution_mode: "real_world"  # or "simulation"
    debug_mode: false

    # Performance parameters
    target_frame_rate: 10  # Hz for vision processing
    max_response_time: 5.0  # seconds for command processing
    real_time_constraints: true

  # Voice-to-Action Pipeline Configuration
  voice_to_action:
    # Audio input settings
    audio_input:
      device: "default"
      sample_rate: 16000
      channels: 1
      bit_depth: 16
      buffer_size: 1024

    # Preprocessing settings
    audio_preprocessing:
      noise_reduction:
        enabled: true
        algorithm: "spectral_subtraction"
        noise_floor: 200
        suppression_level: 0.8

      voice_activity_detection:
        enabled: true
        threshold: 500
        silence_duration: 1.0  # seconds

    # Whisper ASR settings
    speech_recognition:
      model: "base"  # tiny, base, small, medium, large
      device: "cuda"  # cuda or cpu
      language: "en"
      task: "transcribe"
      use_float16: true

    # Intent classification settings
    intent_classification:
      confidence_threshold: 0.7
      fallback_intent: "unknown_command"
      intent_timeout: 2.0  # seconds

  # Cognitive Planning Configuration
  cognitive_planning:
    # LLM settings
    llm:
      model: "gpt-4-turbo"
      api_key: "${LLM_API_KEY}"  # Use environment variable
      temperature: 0.3
      max_tokens: 2048
      timeout: 30  # seconds
      max_retries: 3

    # Planning parameters
    planning:
      max_plan_length: 50  # maximum number of actions in a plan
      plan_validation_enabled: true
      safety_validation_enabled: true
      context_window_size: 10  # number of previous commands to consider

    # Context management
    context:
      short_term_memory:
        enabled: true
        retention_time: 300  # seconds
      long_term_memory:
        enabled: false
        storage_path: "/memory/long_term"

  # Vision-Language Integration Configuration
  vision_language:
    # Camera settings
    camera:
      topic: "/camera/rgb/image_raw"
      message_type: "sensor_msgs/Image"
      frame_rate: 10  # Hz
      resolution: [640, 480]

    # Object detection settings
    object_detection:
      model: "yolov8x-seg.pt"
      confidence_threshold: 0.5
      nms_threshold: 0.4
      max_detections: 100
      device: "cuda"

    # Vision-language grounding
    grounding:
      model: "clip"
      similarity_threshold: 0.3
      top_k_grounding: 5
      grounding_timeout: 1.0  # seconds

    # Scene understanding
    scene_understanding:
      scene_graph_generation: true
      relationship_detection: true
      spatial_reasoning: true

    # Uncertainty management
    uncertainty:
      detection_uncertainty_threshold: 0.8
      grounding_uncertainty_threshold: 0.7
      fallback_strategy: "request_clarification"

  # Action Execution Configuration
  action_execution:
    # Navigation settings
    navigation:
      action_server: "/navigate_to_pose"
      max_velocity: 0.5  # m/s
      safety_margin: 0.5  # meters
      obstacle_avoidance: true
      localization_required: true

    # Manipulation settings
    manipulation:
      action_server: "/manipulation_controller/follow_joint_trajectory"
      grasp_force_limit: 50.0  # Newtons
      position_tolerance: 0.01  # meters
      force_feedback_enabled: true

    # Perception settings
    perception:
      action_server: "/perception_server"
      detection_timeout: 3.0  # seconds
      confidence_threshold: 0.7

    # Execution monitoring
    monitoring:
      action_timeout: 30.0  # seconds per action
      execution_verification: true
      progress_tracking: true
      error_recovery: true

  # ROS 2 Integration Configuration
  ros_integration:
    # Topic configuration
    topics:
      # Voice input
      voice_command_input: "/voice_command"
      speech_text_output: "/speech_text"
      intent_output: "/voice_intent"
      robot_command_input: "/robot_command"

      # Vision input
      image_input: "/camera/rgb/image_raw"
      depth_input: "/camera/depth/image_raw"

      # Planning output
      action_sequence_output: "/action_sequence"
      plan_status_output: "/plan_status"

      # Action execution
      navigation_goal: "/navigate_to_pose/goal"
      manipulation_goal: "/manipulation/goal"
      perception_goal: "/perception/goal"

      # System status
      system_status: "/system_status"
      error_output: "/system_errors"

    # Service configuration
    services:
      # Control services
      start_system: "/start_vla_system"
      stop_system: "/stop_vla_system"
      reset_system: "/reset_vla_system"

      # Query services
      get_system_status: "/get_system_status"
      get_robot_state: "/get_robot_state"
      get_environment_state: "/get_environment_state"

    # Action server configuration
    action_servers:
      execute_plan: "/execute_plan"
      continuous_perception: "/continuous_perception"
      human_interaction: "/human_interaction"

    # QoS settings
    qos:
      default:
        reliability: "reliable"
        durability: "volatile"
        history: "keep_last"
        depth: 10
      sensor_data:
        reliability: "best_effort"
        durability: "volatile"
        history: "keep_last"
        depth: 1
      commands:
        reliability: "reliable"
        durability: "transient_local"
        history: "keep_last"
        depth: 10

  # Safety and Validation Configuration
  safety:
    # System safety constraints
    system_safety:
      emergency_stop_enabled: true
      safety_zones_defined: true
      collision_avoidance_mandatory: true
      human_safety_priority: 1  # highest priority

    # Operational constraints
    operational_constraints:
      maximum_operation_time: 3600  # seconds (1 hour)
      battery_level_threshold: 0.2  # 20% minimum
      computational_load_limit: 0.8  # 80% maximum
      temperature_threshold: 65.0  # Celsius

    # Action safety
    action_safety:
      allowed_action_types: ["navigation", "manipulation", "perception", "communication"]
      forbidden_actions: ["self_modification", "system_shutdown", "unsafe_manipulation"]
      action_validation_required: true

    # Emergency procedures
    emergency:
      emergency_stop_topic: "/emergency_stop"
      safe_position_topic: "/safe_position"
      error_recovery_enabled: true
      human_intervention_required: true

  # Performance Optimization
  performance:
    # Caching settings
    caching:
      enabled: true
      object_cache_size: 1000
      scene_graph_cache_size: 100
      embedding_cache_size: 500
      plan_cache_size: 50
      cache_ttl: 300  # seconds

    # Resource management
    resource_management:
      memory_limit: "4GB"
      cpu_limit: 0.8  # 80% of available CPU
      gpu_memory_fraction: 0.8
      gpu_compute_capability: "6.0"  # minimum CUDA compute capability

    # Processing optimization
    processing:
      batch_size: 1  # vision processing batch size
      max_batch_time: 0.1  # seconds
      parallel_processing: true
      thread_count: 4

  # Monitoring and Logging Configuration
  monitoring:
    # Logging settings
    logging:
      enabled: true
      log_level: "INFO"
      log_file_path: "/logs/vla_system.log"
      sensitive_data_filtering: true
      log_rotation: true
      max_log_size: "100MB"
      backup_count: 5

    # Metrics collection
    metrics:
      collect_performance_metrics: true
      collect_accuracy_metrics: true
      collect_safety_metrics: true
      collect_failure_rates: true
      metrics_export_interval: 60  # seconds
      metrics_export_path: "/metrics/vla_system_metrics.json"

    # System health monitoring
    health_monitoring:
      cpu_usage_monitoring: true
      memory_usage_monitoring: true
      temperature_monitoring: true
      battery_monitoring: true
      network_status_monitoring: true

  # Error Handling and Recovery
  error_handling:
    # Error detection
    error_detection:
      timeout_detection: true
      failure_detection: true
      anomaly_detection: true
      performance_degradation_detection: true

    # Recovery strategies
    recovery_strategies:
      - strategy: "retry_with_backoff"
        applicable_errors: ["timeout", "network_error"]
        max_retries: 3
        base_delay: 1.0  # seconds
      - strategy: "fallback_to_simpler_action"
        applicable_errors: ["execution_failure"]
        description: "Use a simpler version of the action"
      - strategy: "request_human_assistance"
        applicable_errors: ["multiple_failures", "unknown_error"]
        description: "Ask for human help"
      - strategy: "safe_stop_and_report"
        applicable_errors: ["safety_violation", "critical_error"]
        description: "Stop execution and report error"

    # Error reporting
    error_reporting:
      report_to_monitoring: true
      notify_operator: true
      log_error_details: true
      automatic_error_classification: true

  # Integration Patterns
  integration_patterns:
    # VLA component orchestration
    orchestration:
      component_startup_order: ["vision", "voice", "planning", "execution"]
      component_shutdown_order: ["execution", "planning", "voice", "vision"]
      health_check_interval: 5.0  # seconds
      component_dependency_tracking: true

    # Data flow management
    data_flow:
      synchronous_processing: false  # Use asynchronous processing
      data_buffer_size: 10
      data_flow_validation: true
      message_sequencing: true

    # Coordination mechanisms
    coordination:
      message_synchronization: true
      state_consistency: true
      conflict_resolution: true
      resource_conflict_detection: true