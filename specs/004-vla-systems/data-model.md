# Data Model: Vision-Language-Action (VLA) Systems

## Overview

This document defines the key data entities and their relationships for Module 4: Vision-Language-Action (VLA) Systems. The data model encompasses the information structures needed to implement voice-to-action pipelines, cognitive planning with LLMs, vision-language integration, and end-to-end autonomous humanoid systems.

## Core Entities

### 1. VoiceCommand
**Description**: Represents a voice input from a human user that needs to be processed by the VLA system

**Fields**:
- `id`: Unique identifier for the command
- `audio_data`: Raw audio data or path to audio file
- `transcript`: Text transcription of the voice input
- `timestamp`: When the command was received
- `user_context`: Information about the user (optional)
- `intent_confidence`: Confidence level of intent recognition
- `status`: Current processing status (received, processing, completed, failed)

**Validation Rules**:
- `transcript` must be non-empty after processing
- `timestamp` must be in ISO 8601 format
- `intent_confidence` must be between 0.0 and 1.0

### 2. NaturalLanguageIntent
**Description**: Represents the interpreted intent derived from voice command processing

**Fields**:
- `id`: Unique identifier for the intent
- `command_text`: Original text after speech recognition
- `intent_type`: Type of command (navigation, manipulation, information, etc.)
- `parameters`: Structured parameters extracted from the command
- `confidence`: Confidence level of intent classification
- `context`: Environmental or situational context
- `created_at`: Timestamp of intent creation

**Validation Rules**:
- `intent_type` must be from a predefined set of valid types
- `confidence` must be between 0.0 and 1.0
- `parameters` must match the expected structure for the intent type

### 3. TaskPlan
**Description**: Represents a high-level plan generated by the LLM for executing a natural language goal

**Fields**:
- `id`: Unique identifier for the plan
- `goal_description`: Natural language goal that was decomposed
- `subtasks`: Array of subtasks that make up the plan
- `estimated_duration`: Estimated time to complete the plan
- `required_resources`: List of resources needed for plan execution
- `priority`: Priority level for plan execution
- `created_at`: Timestamp of plan creation
- `status`: Current status (planned, executing, completed, failed)

**Validation Rules**:
- `subtasks` array must not be empty
- `estimated_duration` must be positive
- `priority` must be from a predefined set of values

### 4. Subtask
**Description**: A single unit of work within a task plan

**Fields**:
- `id`: Unique identifier for the subtask
- `task_plan_id`: Reference to the parent TaskPlan
- `description`: Human-readable description of the subtask
- `action_type`: Type of action to be performed
- `parameters`: Parameters for the action
- `preconditions`: Conditions that must be true before execution
- `postconditions`: Expected state after execution
- `sequence_number`: Order in which the subtask should be executed

**Validation Rules**:
- `action_type` must be from a predefined set of valid action types
- `sequence_number` must be unique within the parent TaskPlan

### 5. VisionPerceptionResult
**Description**: Represents the output of vision processing and scene understanding

**Fields**:
- `id`: Unique identifier for the perception result
- `timestamp`: When the perception was performed
- `detected_objects`: List of objects detected in the scene
- `scene_description`: Natural language description of the scene
- `spatial_relationships`: Relationships between detected objects
- `confidence_map`: Confidence levels for different aspects of perception
- `contextual_relevance`: Relevance to current task or command

**Validation Rules**:
- `timestamp` must be in ISO 8601 format
- `detected_objects` may be empty but must be an array

### 6. ObjectDetection
**Description**: Represents a single detected object in the visual field

**Fields**:
- `id`: Unique identifier for the detection
- `vision_result_id`: Reference to the parent VisionPerceptionResult
- `object_type`: Type/class of the detected object
- `bounding_box`: Coordinates of the bounding box
- `confidence`: Confidence level of the detection
- `properties`: Additional properties of the object
- `spatial_coordinates`: 3D coordinates in robot's reference frame

**Validation Rules**:
- `confidence` must be between 0.0 and 1.0
- `bounding_box` must have valid coordinate values

### 7. ROS2ActionGoal
**Description**: Represents a goal sent to a ROS 2 action server

**Fields**:
- `id`: Unique identifier for the action goal
- `action_name`: Name of the ROS 2 action server
- `parameters`: Parameters for the action
- `timeout`: Maximum time to wait for completion
- `feedback_callback`: Callback for receiving feedback
- `result_callback`: Callback for receiving results
- `created_at`: Timestamp of goal creation
- `status`: Current status (pending, active, succeeded, aborted, canceled)

**Validation Rules**:
- `action_name` must match a valid ROS 2 action server
- `timeout` must be positive

### 8. ActionExecutionResult
**Description**: Represents the result of executing a robot action

**Fields**:
- `id`: Unique identifier for the execution result
- `action_goal_id`: Reference to the original ROS2ActionGoal
- `success`: Whether the action was successful
- `result_data`: Data returned by the action server
- `error_message`: Error message if action failed
- `execution_time`: Time taken to execute the action
- `feedback_log`: Log of feedback received during execution
- `completed_at`: Timestamp when action completed

**Validation Rules**:
- If `success` is false, `error_message` must not be empty
- `execution_time` must be non-negative

### 9. VisionLanguageMapping
**Description**: Represents the connection between language references and visual elements

**Fields**:
- `id`: Unique identifier for the mapping
- `language_reference`: Text reference from natural language
- `visual_element_id`: ID of the corresponding visual element
- `confidence`: Confidence level of the mapping
- `grounding_method`: Method used for grounding (attention, context, etc.)
- `created_at`: Timestamp of mapping creation

**Validation Rules**:
- `confidence` must be between 0.0 and 1.0
- `grounding_method` must be from a predefined set of valid methods

### 10. SystemState
**Description**: Represents the overall state of the VLA system

**Fields**:
- `id`: Unique identifier for the system state
- `current_task`: Currently executing task or null if idle
- `robot_status`: Current status of the robot
- `last_command`: Most recent command processed
- `perception_cache`: Recent perception results
- `planning_context`: Context information for planning
- `timestamp`: When this state snapshot was taken

**Validation Rules**:
- `timestamp` must be in ISO 8601 format

## Relationships

### TaskPlan → Subtask
- One-to-Many: A TaskPlan contains multiple Subtasks
- Foreign Key: `task_plan_id` in Subtask references `id` in TaskPlan

### VisionPerceptionResult → ObjectDetection
- One-to-Many: A VisionPerceptionResult contains multiple ObjectDetections
- Foreign Key: `vision_result_id` in ObjectDetection references `id` in VisionPerceptionResult

### TaskPlan → ROS2ActionGoal
- One-to-Many: A TaskPlan may generate multiple ROS2ActionGoals during execution
- Indirect relationship through Subtask execution

### ROS2ActionGoal → ActionExecutionResult
- One-to-One: Each ROS2ActionGoal has one corresponding ActionExecutionResult
- Foreign Key: `action_goal_id` in ActionExecutionResult references `id` in ROS2ActionGoal

### VisionPerceptionResult → VisionLanguageMapping
- One-to-Many: A VisionPerceptionResult may have multiple VisionLanguageMappings
- References to ObjectDetection IDs within the mapping

## State Transitions

### VoiceCommand States
- `received` → `processing`: When speech recognition begins
- `processing` → `completed`: When intent is successfully extracted
- `processing` → `failed`: When speech recognition fails
- `completed` → `planning`: When task planning begins
- `failed` → `received`: When retry is attempted

### TaskPlan States
- `planned` → `executing`: When plan execution begins
- `executing` → `completed`: When all subtasks are completed successfully
- `executing` → `failed`: When a subtask fails and cannot be recovered
- `executing` → `paused`: When execution is temporarily suspended

### ROS2ActionGoal States
- `pending` → `active`: When action server begins execution
- `active` → `succeeded`: When action completes successfully
- `active` → `aborted`: When action fails
- `active` → `canceled`: When action is canceled by user

## Validation Rules Summary

1. All timestamps must follow ISO 8601 format
2. Confidence values must be between 0.0 and 1.0
3. Required fields must not be empty or null
4. Foreign key relationships must reference existing entities
5. Enumerated fields must have valid values from predefined sets
6. Numeric values must be within specified ranges
7. Action names must correspond to valid ROS 2 action servers